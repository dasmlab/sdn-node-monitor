# Prometheus ScrapeConfig for SDN Node Monitor
# This configures Prometheus to scrape metrics from the SDN node monitor containers
# running on each SDN node.
#
# Note: The container runs on port 8080 internally, but is mapped to host port 8989
# The scrape target should use the host IP and port 8989
#
# For RHOSO Observability Suite (Prometheus Operator with ScrapeConfig CRD)
# apiVersion: monitoring.coreos.com/v1alpha1

apiVersion: monitoring.coreos.com/v1alpha1
kind: ScrapeConfig
metadata:
  name: ext-sdn-monitor
  namespace: monitoring
  labels:
    prometheus: system-monitoring-prometheus
spec:
  staticConfigs:
    - labels:
        job: ext-sdn-monitor
        component: sdn-monitoring
        # Add hostname label per target (update with actual hostnames)
        # hostname: 'est2-m1-sdn01.idm.est.ngq.extra'
      targets:
        # Add SDN node IPs here - use host port 8989 (container port 8080 is mapped to 8989)
        - "192.168.1.2:8989"
        # Add more nodes as needed:
        # - "192.168.1.3:8989"
        # - "192.168.1.4:8989"
  metricsPath: /metrics
  scheme: http
  scrapeInterval: 30s
  relabelConfigs:
    # Add instance label from target
    - sourceLabels: [__address__]
      regex: '([^:]+):\d+'
      targetLabel: instance
      replacement: '${1}'
    # Add node label (extract IP from target)
    - sourceLabels: [__address__]
      regex: '([^:]+):\d+'
      targetLabel: node
      replacement: '${1}'
    # Add hostname label - if hostname is set in static_configs labels, use it
    - sourceLabels: [__meta_static_label_hostname]
      targetLabel: hostname
      # If hostname not in static labels, you can set it per target in static_configs
      # Or use this to copy from another label:
      # - sourceLabels: [instance]
      #   targetLabel: hostname
      #   replacement: '${1}'  # This would set hostname = IP (if you want that)
